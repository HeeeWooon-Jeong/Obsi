
> [!NOTE] 서브쿼리
> 서브쿼리(Subquery)는 SQL 쿼리 내부에 포함된 다른 쿼리입니다.
>  서브쿼리는 주로 외부 쿼리의 결과를 특정 조건에 따라 필터링하거나, 
>  서브쿼리의 결과를 기반으로 외부 쿼리의 연산에 사용하는 데 사용됩니다.
>  서브쿼리는 여러 가지 상황에서 유용하게 활용됩니다.

서브쿼리는 SQL 쿼리 안에 있는 작은 쿼리입니다. 이 작은 쿼리는 주요 쿼리의 일부로 사용되며, 다양한 목적으로 활용됩니다.

간단한 예를 들어보겠습니다. 상상해보세요, 당신이 레스토랑 메뉴를 관리하는 데이터베이스를 가지고 있다고 가정합니다. 이 메뉴 데이터베이스에는 음식 항목과 가격 정보가 포함되어 있습니다. 여기에서 서브쿼리를 사용하는 몇 가지 예제:

1. **가장 비싼 음식 찾기**: 메뉴에서 가장 비싼 음식을 찾고 싶다고 가정합니다. 서브쿼리를 사용하면 메뉴 항목 중에서 최고 가격을 서브쿼리로 가져와서 주요 쿼리에서 사용할 수 있습니다.

    ```sql
    SELECT food_name
    FROM menu
    WHERE price = (SELECT MAX(price) FROM menu);
    ```

2. **평균 가격보다 비싼 음식 찾기**: 메뉴에서 평균 가격보다 더 비싼 음식을 찾고 싶다면 서브쿼리를 사용하여 평균 가격을 계산하고 그 값을 주요 쿼리에서 비교할 수 있습니다.

    ```sql
    SELECT food_name
    FROM menu
    WHERE price > (SELECT AVG(price) FROM menu);
    ```

3. **음식 카테고리 검색**: 특정 음식 카테고리(예: 피자)에 속하는 모든 음식을 찾으려면 카테고리 이름을 서브쿼리에서 가져와서 주요 쿼리에서 필터링할 수 있습니다.

    ```sql
    SELECT food_name
    FROM menu
    WHERE category = (SELECT category_name FROM categories WHERE category_id = 1);
    ```

이런 식으로 서브쿼리를 사용하면 주요 쿼리에서 작은 쿼리를 사용하여 데이터를 더 효과적으로 검색하거나 필터링할 수 있습니다.

1. **서브쿼리의 종류**:
   - **스칼라 서브쿼리**: 단일 값을 반환하는 서브쿼리입니다.
   - **테이블 서브쿼리**: 여러 행과 열을 반환하는 서브쿼리입니다.
   - **인라인 뷰**: 서브쿼리 결과를 임시 테이블로 사용하는 것과 유사한 구조입니다.

2. **서브쿼리의 위치**:
   - **SELECT 절**: 열의 값을 계산하기 위해 서브쿼리를 사용할 수 있습니다.
   - **FROM 절**: 서브쿼리 결과를 일시적인 테이블로 사용할 수 있습니다.
   - **WHERE 절**: 조건을 만족하는 행을 필터링하기 위해 서브쿼리를 사용할 수 있습니다.

3. **사용 사례**:
   - **서브쿼리를 사용한 필터링**: 서브쿼리를 사용하여 특정 조건을 만족하는 행을 선택할 수 있습니다.
   - **서브쿼리를 사용한 비교**: 서브쿼리 결과를 기반으로 외부 쿼리와 비교하여 작업을 수행할 수 있습니다.
   - **서브쿼리를 사용한 집계**: 서브쿼리를 사용하여 그룹화된 데이터의 합계, 평균 등을 계산할 수 있습니다.

서브쿼리는 데이터베이스 쿼리 작성을 더 유연하게 만들고 복잡한 조건과 필터링을 수행할 수 있게 해줍니다. 그러나 서브쿼리를 남용하면 쿼리의 가독성을 낮출 수 있으므로 적절한 상황에서 사용하는 것이 좋습니다.
